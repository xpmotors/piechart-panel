{"version":3,"sources":["../src/legend.js"],"names":["angular","kbn","$","PerfectScrollbar","module","directive","popoverSrv","$timeout","link","scope","elem","$container","firstRender","ctrl","panel","data","seriesList","dataList","i","legendScrollbar","$on","destroy","events","on","series","color","render","getSeriesIndexForElement","el","parents","toggleSeries","e","currentTarget","index","seriesInfo","scrollPosition","children","scrollTop","sortLegend","stat","legend","sort","sortDesc","getLegendHeaderHtml","statName","name","header","html","cssClass","getLegendPercentageHtml","openColorSelector","target","length","find","show","element","position","template","openOn","model","autoClose","toggleAxis","colorSelected","changeSeriesColor","legendType","empty","css","append","width","sideWidth","ieWidth","showValues","values","percentage","tableLayout","toggleClass","legendHeader","valueName","total","stats","seriesShown","seriesElements","seriesData","hideEmpty","allIsNull","decimal","percentageDecimals","hiddenSeries","label","value","legendData","formatValue","pvalue","toFixed","push","topPadding","tbodyElem","addScrollbar","destroyScrollbar","scrollbarOptions","scrollYMarginOffset","suppressScrollX","update"],"mappings":";;;;;;;;AAAOA,MAAAA,O;;AACAC,MAAAA,G;;AACAC,MAAAA,C;;AAGAC,MAAAA,gB;;;AAEPH,MAAAA,OAAO,CACJI,MADH,CACU,oBADV,EAEGC,SAFH,CAEa,gBAFb,EAE+B,UAASC,UAAT,EAAqBC,QAArB,EAA+B;AAC1D,eAAO;AACLC,UAAAA,IAAI,EAAE,cAASC,KAAT,EAAgBC,IAAhB,EAAsB;AAC1B,gBAAIC,UAAU,GAAGT,CAAC,CAAC,gDAAD,CAAlB;AACA,gBAAIU,WAAW,GAAG,IAAlB;AACA,gBAAIC,IAAI,GAAGJ,KAAK,CAACI,IAAjB;AACA,gBAAIC,KAAK,GAAGD,IAAI,CAACC,KAAjB;AACA,gBAAIC,IAAJ;AACA,gBAAIC,UAAJ;AACA,gBAAIC,QAAJ;AACA,gBAAIC,CAAJ;AACA,gBAAIC,eAAJ;AAEAV,YAAAA,KAAK,CAACW,GAAN,CAAU,UAAV,EAAsB,YAAW;AAC/B,kBAAID,eAAJ,EAAqB;AACnBA,gBAAAA,eAAe,CAACE,OAAhB;AACD;AACF,aAJD;AAMAR,YAAAA,IAAI,CAACS,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAW;AAClCR,cAAAA,IAAI,GAAGF,IAAI,CAACW,MAAZ;;AACA,kBAAIT,IAAJ,EAAU;AACN,qBAAK,IAAIG,CAAT,IAAcH,IAAd,EAAoB;AAClBA,kBAAAA,IAAI,CAACG,CAAD,CAAJ,CAAQO,KAAR,GAAgBZ,IAAI,CAACE,IAAL,CAAUG,CAAV,EAAaO,KAA7B;AACD;;AACHC,gBAAAA,MAAM;AACP;AACF,aARD;;AAUA,qBAASC,wBAAT,CAAkCC,EAAlC,EAAsC;AACpC,qBAAOA,EAAE,CAACC,OAAH,CAAW,qBAAX,EAAkCd,IAAlC,CAAuC,cAAvC,CAAP;AACD;;AAED,qBAASe,YAAT,CAAsBC,CAAtB,EAAyB;AACvB,kBAAIH,EAAE,GAAG1B,CAAC,CAAC6B,CAAC,CAACC,aAAH,CAAV;AACA,kBAAIC,KAAK,GAAGN,wBAAwB,CAACC,EAAD,CAApC;AACA,kBAAIM,UAAU,GAAGjB,QAAQ,CAACgB,KAAD,CAAzB;AACA,kBAAIE,cAAc,GAAGjC,CAAC,CAACS,UAAU,CAACyB,QAAX,CAAoB,OAApB,CAAD,CAAD,CAAgCC,SAAhC,EAArB;AACAxB,cAAAA,IAAI,CAACiB,YAAL,CAAkBI,UAAlB;AACAhC,cAAAA,CAAC,CAACS,UAAU,CAACyB,QAAX,CAAoB,OAApB,CAAD,CAAD,CAAgCC,SAAhC,CAA0CF,cAA1C;AACD;;AAED,qBAASG,UAAT,CAAoBP,CAApB,EAAuB;AACrB,kBAAIH,EAAE,GAAG1B,CAAC,CAAC6B,CAAC,CAACC,aAAH,CAAV;AACA,kBAAIO,IAAI,GAAGX,EAAE,CAACb,IAAH,CAAQ,MAAR,CAAX;;AAEA,kBAAIwB,IAAI,KAAKzB,KAAK,CAAC0B,MAAN,CAAaC,IAA1B,EAAgC;AAC9B3B,gBAAAA,KAAK,CAAC0B,MAAN,CAAaE,QAAb,GAAwB,IAAxB;AACD,eANoB,CAQrB;;;AACA,kBAAI5B,KAAK,CAAC0B,MAAN,CAAaE,QAAb,KAA0B,KAA9B,EAAqC;AACnC5B,gBAAAA,KAAK,CAAC0B,MAAN,CAAaC,IAAb,GAAoB,IAApB;AACA3B,gBAAAA,KAAK,CAAC0B,MAAN,CAAaE,QAAb,GAAwB,IAAxB;AACA7B,gBAAAA,IAAI,CAACa,MAAL;AACA;AACD;;AAEDZ,cAAAA,KAAK,CAAC0B,MAAN,CAAaE,QAAb,GAAwB,CAAC5B,KAAK,CAAC0B,MAAN,CAAaE,QAAtC;AACA5B,cAAAA,KAAK,CAAC0B,MAAN,CAAaC,IAAb,GAAoBF,IAApB;AACA1B,cAAAA,IAAI,CAACa,MAAL;AACD;;AAED,qBAASiB,mBAAT,CAA6BC,QAA7B,EAAuC;AACrC,kBAAIC,IAAI,GAAGD,QAAX;;AAEA,kBAAI9B,KAAK,CAAC0B,MAAN,CAAaM,MAAjB,EAAyB;AACvBD,gBAAAA,IAAI,GAAG/B,KAAK,CAAC0B,MAAN,CAAaM,MAApB;AACD;;AAED,kBAAIC,IAAI,GAAG,oCAAoCH,QAApC,GAA+C,IAA/C,GAAsDC,IAAjE;;AAEA,kBAAI/B,KAAK,CAAC0B,MAAN,CAAaC,IAAb,KAAsBG,QAA1B,EAAoC;AAClC,oBAAII,QAAQ,GAAGlC,KAAK,CAAC0B,MAAN,CAAaE,QAAb,GACX,kBADW,GAEX,gBAFJ;AAGAK,gBAAAA,IAAI,IAAI,mBAAmBC,QAAnB,GAA8B,WAAtC;AACD;;AAED,qBAAOD,IAAI,GAAG,OAAd;AACD;;AAED,qBAASE,uBAAT,CAAiCL,QAAjC,EAA2C;AACzC,kBAAIC,IAAI,GAAG,YAAX;AACA,kBAAIE,IAAI,GAAG,oCAAoCH,QAApC,GAA+C,IAA/C,GAAsDC,IAAjE;;AAEA,kBAAI/B,KAAK,CAAC0B,MAAN,CAAaC,IAAb,KAAsBG,QAA1B,EAAoC;AAClC,oBAAII,QAAQ,GAAGlC,KAAK,CAAC0B,MAAN,CAAaE,QAAb,GACX,kBADW,GAEX,gBAFJ;AAGAK,gBAAAA,IAAI,IAAI,mBAAmBC,QAAnB,GAA8B,WAAtC;AACD;;AAED,qBAAOD,IAAI,GAAG,OAAd;AACD;;AAED,qBAASG,iBAAT,CAA2BnB,CAA3B,EAA8B;AAC5B;AACA,kBAAI7B,CAAC,CAAC6B,CAAC,CAACoB,MAAH,CAAD,CAAYtB,OAAZ,CAAoB,UAApB,EAAgCuB,MAApC,EAA4C;AAC1C;AACD;;AAED,kBAAIxB,EAAE,GAAG1B,CAAC,CAAC6B,CAAC,CAACC,aAAH,CAAD,CAAmBqB,IAAnB,CAAwB,WAAxB,CAAT;AACA,kBAAIpB,KAAK,GAAGN,wBAAwB,CAACC,EAAD,CAApC;AACA,kBAAIJ,MAAM,GAAGR,UAAU,CAACiB,KAAD,CAAvB;AAEA1B,cAAAA,QAAQ,CAAC,YAAW;AAClBD,gBAAAA,UAAU,CAACgD,IAAX,CAAgB;AACdC,kBAAAA,OAAO,EAAE3B,EAAE,CAAC,CAAD,CADG;AAEd4B,kBAAAA,QAAQ,EAAE,eAFI;AAGdC,kBAAAA,QAAQ,EACN,kGACA,wBALY;AAMdC,kBAAAA,MAAM,EAAE,OANM;AAOdC,kBAAAA,KAAK,EAAE;AACLC,oBAAAA,SAAS,EAAE,IADN;AAELpC,oBAAAA,MAAM,EAAEA,MAFH;AAGLqC,oBAAAA,UAAU,EAAE,sBAAW,CAAE,CAHpB;AAILC,oBAAAA,aAAa,EAAE,uBAASrC,KAAT,EAAgB;AAC7BZ,sBAAAA,IAAI,CAACkD,iBAAL,CAAuBvC,MAAvB,EAA+BC,KAA/B;AACD;AANI;AAPO,iBAAhB;AAgBD,eAjBO,CAAR;AAkBD;;AAED,qBAASC,MAAT,GAAkB;AAChB,kBAAIZ,KAAK,CAACkD,UAAN,KAAqB,UAArB,IAAmC,CAAClD,KAAK,CAAC0B,MAAN,CAAac,IAArD,EAA2D;AACzD3C,gBAAAA,UAAU,CAACsD,KAAX;AACAvD,gBAAAA,IAAI,CAAC2C,IAAL,CAAU,kBAAV,EAA8Ba,GAA9B,CAAkC,aAAlC,EAAiD,CAAjD;AACA;AACD,eAJD,MAIO;AACLxD,gBAAAA,IAAI,CAAC2C,IAAL,CAAU,kBAAV,EAA8Ba,GAA9B,CAAkC,aAAlC,EAAiD,CAAjD;AACD;;AAGD,kBAAItD,WAAJ,EAAiB;AACfF,gBAAAA,IAAI,CAACyD,MAAL,CAAYxD,UAAZ;AACAA,gBAAAA,UAAU,CAACY,EAAX,CAAc,OAAd,EAAuB,uBAAvB,EAAgD2B,iBAAhD;AACAvC,gBAAAA,UAAU,CAACY,EAAX,CAAc,OAAd,EAAuB,wBAAvB,EAAiDO,YAAjD;AACAnB,gBAAAA,UAAU,CAACY,EAAX,CAAc,OAAd,EAAuB,IAAvB,EAA6Be,UAA7B;AACA1B,gBAAAA,WAAW,GAAG,KAAd;AACD;;AAEDI,cAAAA,UAAU,GAAGD,IAAb;AACAE,cAAAA,QAAQ,GAAGJ,IAAI,CAACE,IAAhB;AAEAJ,cAAAA,UAAU,CAACsD,KAAX;AAEA,kBAAIG,KAAK,GAAGtD,KAAK,CAACkD,UAAN,IAAoB,YAApB,IAAoClD,KAAK,CAAC0B,MAAN,CAAa6B,SAAjD,GAA6DvD,KAAK,CAAC0B,MAAN,CAAa6B,SAAb,GAAyB,IAAtF,GAA6F,EAAzG;AACA,kBAAIC,OAAO,GAAGxD,KAAK,CAACkD,UAAN,IAAoB,YAApB,IAAoClD,KAAK,CAAC0B,MAAN,CAAa6B,SAAjD,GAA6DvD,KAAK,CAAC0B,MAAN,CAAa6B,SAAb,GAAyB,CAAzB,GAA6B,IAA1F,GAAiG,EAA/G;AACA3D,cAAAA,IAAI,CAACwD,GAAL,CAAS,WAAT,EAAsBE,KAAtB;AACA1D,cAAAA,IAAI,CAACwD,GAAL,CAAS,OAAT,EAAkBI,OAAlB;AAEA,kBAAIC,UAAU,GAAGzD,KAAK,CAAC0B,MAAN,CAAagC,MAAb,IAAuB1D,KAAK,CAAC0B,MAAN,CAAaiC,UAArD;AACA,kBAAIC,WAAW,GACb,CAAC5D,KAAK,CAACkD,UAAN,KAAqB,aAArB,IACClD,KAAK,CAACkD,UAAN,KAAqB,YADvB,KAEAO,UAHF;AAKA5D,cAAAA,UAAU,CAACgE,WAAX,CAAuB,uBAAvB,EAAgDD,WAAhD;AAEA,kBAAIE,YAAJ;;AACA,kBAAIF,WAAJ,EAAiB;AACf,oBAAI5B,MAAM,GAAG,mDAAb;;AACA,oBAAIhC,KAAK,CAAC0B,MAAN,CAAagC,MAAjB,EAAyB;AACvB1B,kBAAAA,MAAM,IAAIH,mBAAmB,CAAC9B,IAAI,CAACC,KAAL,CAAW+D,SAAZ,CAA7B;AACD;;AACD,oBAAI/D,KAAK,CAAC0B,MAAN,CAAaiC,UAAjB,EAA6B;AAC3B3B,kBAAAA,MAAM,IAAIG,uBAAuB,CAACpC,IAAI,CAACC,KAAL,CAAW+D,SAAZ,CAAjC;AACD;;AACD/B,gBAAAA,MAAM,IAAI,OAAV;AACA8B,gBAAAA,YAAY,GAAG1E,CAAC,CAAC4C,MAAD,CAAhB;AACD;;AAED,kBAAIhC,KAAK,CAAC0B,MAAN,CAAaiC,UAAjB,EAA6B;AAC3B,oBAAIK,KAAK,GAAG,CAAZ;;AACA,qBAAK5D,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGF,UAAU,CAACoC,MAA3B,EAAmClC,CAAC,EAApC,EAAwC;AACtC4D,kBAAAA,KAAK,IAAI9D,UAAU,CAACE,CAAD,CAAV,CAAc6D,KAAd,CAAoBlE,IAAI,CAACC,KAAL,CAAW+D,SAA/B,CAAT;AACD;AACF;;AAED,kBAAIG,WAAW,GAAG,CAAlB;AACA,kBAAIC,cAAc,GAAG,EAArB;;AAEA,mBAAK/D,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGF,UAAU,CAACoC,MAA3B,EAAmClC,CAAC,EAApC,EAAwC;AACtC,oBAAIM,MAAM,GAAGR,UAAU,CAACE,CAAD,CAAvB;AACA,oBAAIgE,UAAU,GAAGjE,QAAQ,CAACC,CAAD,CAAzB,CAFsC,CAItC;;AACA,oBAAIJ,KAAK,CAAC0B,MAAN,CAAa2C,SAAb,IAA0B3D,MAAM,CAAC4D,SAArC,EAAgD;AAC9C;AACD,iBAPqC,CAQtC;;;AACA,oBAAI,CAAC5D,MAAM,CAACgB,MAAZ,EAAoB;AAClB;AACD;;AAED,oBAAI6C,OAAO,GAAG,CAAd;;AACA,oBAAIxE,IAAI,CAACC,KAAL,CAAW0B,MAAX,CAAkB8C,kBAAtB,EAA0C;AACxCD,kBAAAA,OAAO,GAAGxE,IAAI,CAACC,KAAL,CAAW0B,MAAX,CAAkB8C,kBAA5B;AACD;;AAED,oBAAIvC,IAAI,GAAG,oCAAX;;AACA,oBAAIlC,IAAI,CAAC0E,YAAL,CAAkBL,UAAU,CAACM,KAA7B,CAAJ,EAAyC;AACvCzC,kBAAAA,IAAI,IAAI,gCAAR;AACD;;AACDA,gBAAAA,IAAI,IAAI,0BAA0B7B,CAA1B,GAA8B,IAAtC;AACA6B,gBAAAA,IAAI,IAAI,yDAAR;AACAA,gBAAAA,IAAI,IACF,iDACAmC,UAAU,CAACzD,KADX,GAEA,QAHF;AAIAsB,gBAAAA,IAAI,IAAI,SAAR;AAEAA,gBAAAA,IAAI,IACF,0DACAmC,UAAU,CAACM,KADX,GAEA,MAHF;;AAKA,oBAAIjB,UAAU,IAAIG,WAAlB,EAA+B;AAC7B,sBAAIe,KAAK,GAAGP,UAAU,CAACQ,UAAvB;;AACA,sBAAI5E,KAAK,CAAC0B,MAAN,CAAagC,MAAjB,EAAyB;AACvBzB,oBAAAA,IAAI,IACF,wCACAlC,IAAI,CAAC8E,WAAL,CAAiBF,KAAjB,CADA,GAEA,QAHF;AAID;;AACD,sBAAIX,KAAJ,EAAW;AACT,wBAAIc,MAAM,GAAG,CAACH,KAAK,GAAGX,KAAR,GAAgB,GAAjB,EAAsBe,OAAtB,CAA8BR,OAA9B,IAAyC,GAAtD;AACAtC,oBAAAA,IAAI,IAAI,wCAAwC6C,MAAxC,GAAiD,QAAzD;AACD;AACF;;AAED7C,gBAAAA,IAAI,IAAI,QAAR;AAEAkC,gBAAAA,cAAc,CAACa,IAAf,CAAoB5F,CAAC,CAAC6C,IAAD,CAArB;AACAiC,gBAAAA,WAAW;AACZ;;AACD,kBAAIN,WAAJ,EAAiB;AACf,oBAAIqB,UAAU,GAAG,CAAjB;AACA,oBAAIC,SAAS,GAAG9F,CAAC,CAAC,iBAAD,CAAjB,CAFe,CAGf;;AACA8F,gBAAAA,SAAS,CAAC7B,MAAV,CAAiBS,YAAjB;AACAoB,gBAAAA,SAAS,CAAC7B,MAAV,CAAiBc,cAAjB;AACAtE,gBAAAA,UAAU,CAACwD,MAAX,CAAkB6B,SAAlB;AACD,eAPD,MAOO;AACLrF,gBAAAA,UAAU,CAACwD,MAAX,CAAkBc,cAAlB;AACD;;AAED,kBAAInE,KAAK,CAACkD,UAAN,KAAqB,aAAzB,EAAwC;AACtCiC,gBAAAA,YAAY;AACb,eAFD,MAEO;AACLC,gBAAAA,gBAAgB;AACjB;AACF;;AACD,qBAASD,YAAT,GAAwB;AACtB,kBAAME,gBAAgB,GAAG;AACvB;AACAC,gBAAAA,mBAAmB,EAAE,CAFE;AAGvBC,gBAAAA,eAAe,EAAE;AAHM,eAAzB;;AAMA,kBAAI,CAAClF,eAAL,EAAsB;AACpBA,gBAAAA,eAAe,GAAG,IAAIhB,gBAAJ,CAChBO,IAAI,CAAC,CAAD,CADY,EAEhByF,gBAFgB,CAAlB;AAID,eALD,MAKO;AACLhF,gBAAAA,eAAe,CAACmF,MAAhB;AACD;AACF;;AAED,qBAASJ,gBAAT,GAA4B;AAC1B,kBAAI/E,eAAJ,EAAqB;AACnBA,gBAAAA,eAAe,CAACE,OAAhB;AACAF,gBAAAA,eAAe,GAAG,IAAlB;AACD;AACF;AACF;AAtRI,SAAP;AAwRD,OA3RH","sourcesContent":["import angular from \"angular\";\r\nimport kbn from \"app/core/utils/kbn\";\r\nimport $ from \"jquery\";\r\nimport \"jquery.flot\";\r\nimport \"jquery.flot.time\";\r\nimport PerfectScrollbar from \"./lib/perfect-scrollbar.min\";\r\n\r\nangular\r\n  .module(\"grafana.directives\")\r\n  .directive(\"piechartLegend\", function(popoverSrv, $timeout) {\r\n    return {\r\n      link: function(scope, elem) {\r\n        var $container = $('<div class=\"piechart-legend__container\"></div>');\r\n        var firstRender = true;\r\n        var ctrl = scope.ctrl;\r\n        var panel = ctrl.panel;\r\n        var data;\r\n        var seriesList;\r\n        var dataList;\r\n        var i;\r\n        var legendScrollbar;\r\n\r\n        scope.$on(\"$destroy\", function() {\r\n          if (legendScrollbar) {\r\n            legendScrollbar.destroy();\r\n          }\r\n        });\r\n\r\n        ctrl.events.on(\"render\", function() {\r\n          data = ctrl.series;\r\n          if (data) {\r\n              for (var i in data) {\r\n                data[i].color = ctrl.data[i].color;\r\n              }\r\n            render();\r\n          }\r\n        });\r\n\r\n        function getSeriesIndexForElement(el) {\r\n          return el.parents(\"[data-series-index]\").data(\"series-index\");\r\n        }\r\n\r\n        function toggleSeries(e) {\r\n          var el = $(e.currentTarget);\r\n          var index = getSeriesIndexForElement(el);\r\n          var seriesInfo = dataList[index];\r\n          var scrollPosition = $($container.children(\"tbody\")).scrollTop();\r\n          ctrl.toggleSeries(seriesInfo);\r\n          $($container.children(\"tbody\")).scrollTop(scrollPosition);\r\n        }\r\n\r\n        function sortLegend(e) {\r\n          var el = $(e.currentTarget);\r\n          var stat = el.data(\"stat\");\r\n\r\n          if (stat !== panel.legend.sort) {\r\n            panel.legend.sortDesc = null;\r\n          }\r\n\r\n          // if already sort ascending, disable sorting\r\n          if (panel.legend.sortDesc === false) {\r\n            panel.legend.sort = null;\r\n            panel.legend.sortDesc = null;\r\n            ctrl.render();\r\n            return;\r\n          }\r\n\r\n          panel.legend.sortDesc = !panel.legend.sortDesc;\r\n          panel.legend.sort = stat;\r\n          ctrl.render();\r\n        }\r\n\r\n        function getLegendHeaderHtml(statName) {\r\n          var name = statName;\r\n\r\n          if (panel.legend.header) {\r\n            name = panel.legend.header;\r\n          }\r\n\r\n          var html = '<th class=\"pointer\" data-stat=\"' + statName + '\">' + name;\r\n\r\n          if (panel.legend.sort === statName) {\r\n            var cssClass = panel.legend.sortDesc\r\n              ? \"fa fa-caret-down\"\r\n              : \"fa fa-caret-up\";\r\n            html += ' <span class=\"' + cssClass + '\"></span>';\r\n          }\r\n\r\n          return html + \"</th>\";\r\n        }\r\n\r\n        function getLegendPercentageHtml(statName) {\r\n          var name = \"percentage\";\r\n          var html = '<th class=\"pointer\" data-stat=\"' + statName + '\">' + name;\r\n\r\n          if (panel.legend.sort === statName) {\r\n            var cssClass = panel.legend.sortDesc\r\n              ? \"fa fa-caret-down\"\r\n              : \"fa fa-caret-up\";\r\n            html += ' <span class=\"' + cssClass + '\"></span>';\r\n          }\r\n\r\n          return html + \"</th>\";\r\n        }\r\n\r\n        function openColorSelector(e) {\r\n          // if we clicked inside poup container ignore click\r\n          if ($(e.target).parents(\".popover\").length) {\r\n            return;\r\n          }\r\n\r\n          var el = $(e.currentTarget).find(\".fa-minus\");\r\n          var index = getSeriesIndexForElement(el);\r\n          var series = seriesList[index];\r\n\r\n          $timeout(function() {\r\n            popoverSrv.show({\r\n              element: el[0],\r\n              position: \"bottom center\",\r\n              template:\r\n                '<series-color-picker series=\"series\" onToggleAxis=\"toggleAxis\" onColorChange=\"colorSelected\">' +\r\n                \"</series-color-picker>\",\r\n              openOn: \"hover\",\r\n              model: {\r\n                autoClose: true,\r\n                series: series,\r\n                toggleAxis: function() {},\r\n                colorSelected: function(color) {\r\n                  ctrl.changeSeriesColor(series, color);\r\n                }\r\n              }\r\n            });\r\n          });\r\n        }\r\n\r\n        function render() {\r\n          if (panel.legendType === \"On graph\" || !panel.legend.show) {\r\n            $container.empty();\r\n            elem.find(\".piechart-legend\").css(\"padding-top\", 0);\r\n            return;\r\n          } else {\r\n            elem.find(\".piechart-legend\").css(\"padding-top\", 6);\r\n          }\r\n\r\n\r\n          if (firstRender) {\r\n            elem.append($container);\r\n            $container.on(\"click\", \".piechart-legend-icon\", openColorSelector);\r\n            $container.on(\"click\", \".piechart-legend-alias\", toggleSeries);\r\n            $container.on(\"click\", \"th\", sortLegend);\r\n            firstRender = false;\r\n          }\r\n\r\n          seriesList = data;\r\n          dataList = ctrl.data;\r\n\r\n          $container.empty();\r\n\r\n          var width = panel.legendType == \"Right side\" && panel.legend.sideWidth ? panel.legend.sideWidth + \"px\" : \"\";\r\n          var ieWidth = panel.legendType == \"Right side\" && panel.legend.sideWidth ? panel.legend.sideWidth - 1 + \"px\" : \"\";\r\n          elem.css(\"min-width\", width);\r\n          elem.css(\"width\", ieWidth);\r\n\r\n          var showValues = panel.legend.values || panel.legend.percentage;\r\n          var tableLayout =\r\n            (panel.legendType === \"Under graph\" ||\r\n              panel.legendType === \"Right side\") &&\r\n            showValues;\r\n\r\n          $container.toggleClass(\"piechart-legend-table\", tableLayout);\r\n\r\n          var legendHeader;\r\n          if (tableLayout) {\r\n            var header = '<tr><th colspan=\"2\" style=\"text-align:left\"></th>';\r\n            if (panel.legend.values) {\r\n              header += getLegendHeaderHtml(ctrl.panel.valueName);\r\n            }\r\n            if (panel.legend.percentage) {\r\n              header += getLegendPercentageHtml(ctrl.panel.valueName);\r\n            }\r\n            header += \"</tr>\";\r\n            legendHeader = $(header);\r\n          }\r\n\r\n          if (panel.legend.percentage) {\r\n            var total = 0;\r\n            for (i = 0; i < seriesList.length; i++) {\r\n              total += seriesList[i].stats[ctrl.panel.valueName];\r\n            }\r\n          }\r\n\r\n          var seriesShown = 0;\r\n          var seriesElements = [];\r\n\r\n          for (i = 0; i < seriesList.length; i++) {\r\n            var series = seriesList[i];\r\n            var seriesData = dataList[i];\r\n\r\n            // ignore empty series\r\n            if (panel.legend.hideEmpty && series.allIsNull) {\r\n              continue;\r\n            }\r\n            // ignore series excluded via override\r\n            if (!series.legend) {\r\n              continue;\r\n            }\r\n\r\n            var decimal = 0;\r\n            if (ctrl.panel.legend.percentageDecimals) {\r\n              decimal = ctrl.panel.legend.percentageDecimals;\r\n            }\r\n\r\n            var html = '<div class=\"piechart-legend-series';\r\n            if (ctrl.hiddenSeries[seriesData.label]) {\r\n              html += \" piechart-legend-series-hidden\";\r\n            }\r\n            html += '\" data-series-index=\"' + i + '\">';\r\n            html += '<span class=\"piechart-legend-icon\" style=\"float:none;\">';\r\n            html +=\r\n              '<i class=\"fa fa-minus pointer\" style=\"color:' +\r\n              seriesData.color +\r\n              '\"></i>';\r\n            html += \"</span>\";\r\n\r\n            html +=\r\n              '<a class=\"piechart-legend-alias\" style=\"float:none;\">' +\r\n              seriesData.label +\r\n              \"</a>\";\r\n\r\n            if (showValues && tableLayout) {\r\n              var value = seriesData.legendData;\r\n              if (panel.legend.values) {\r\n                html +=\r\n                  '<div class=\"piechart-legend-value\">' +\r\n                  ctrl.formatValue(value) +\r\n                  \"</div>\";\r\n              }\r\n              if (total) {\r\n                var pvalue = (value / total * 100).toFixed(decimal) + \"%\";\r\n                html += '<div class=\"piechart-legend-value\">' + pvalue + \"</div>\";\r\n              }\r\n            }\r\n\r\n            html += \"</div>\";\r\n\r\n            seriesElements.push($(html));\r\n            seriesShown++;\r\n          }\r\n          if (tableLayout) {\r\n            var topPadding = 6;\r\n            var tbodyElem = $(\"<tbody></tbody>\");\r\n            // tbodyElem.css(\"max-height\", maxHeight - topPadding);\r\n            tbodyElem.append(legendHeader);\r\n            tbodyElem.append(seriesElements);\r\n            $container.append(tbodyElem);\r\n          } else {\r\n            $container.append(seriesElements);\r\n          }\r\n\r\n          if (panel.legendType === \"Under graph\") {\r\n            addScrollbar();\r\n          } else {\r\n            destroyScrollbar();\r\n          }\r\n        }\r\n        function addScrollbar() {\r\n          const scrollbarOptions = {\r\n            // Number of pixels the content height can surpass the container height without enabling the scroll bar.\r\n            scrollYMarginOffset: 2,\r\n            suppressScrollX: true\r\n          };\r\n\r\n          if (!legendScrollbar) {\r\n            legendScrollbar = new PerfectScrollbar(\r\n              elem[0],\r\n              scrollbarOptions\r\n            );\r\n          } else {\r\n            legendScrollbar.update();\r\n          }\r\n        }\r\n\r\n        function destroyScrollbar() {\r\n          if (legendScrollbar) {\r\n            legendScrollbar.destroy();\r\n            legendScrollbar = null;\r\n          }\r\n        }\r\n      }\r\n    };\r\n  });\r\n"],"file":"legend.js"}